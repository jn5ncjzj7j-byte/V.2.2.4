<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title id="pageTitle">Cost Calculator Pro</title> 

  <style>
    :root {
      --primary: #4CAF50;
      --primary-hover: #45a049;
      --bg-light: #f8f9fa;
      --bg-dark: #121212;
      --card-light: #ffffff;
      --card-dark: #1e1e1e;
      --text-light: #333333;
      --text-dark: #eeeeee;
    }

    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      margin: 0; padding: 20px; display: flex; justify-content: center;
      min-height: 100vh; background: var(--bg-light); color: var(--text-light);
      transition: background 0.5s ease, color 0.5s ease;
    }
    body.dark { background: var(--bg-dark); color: var(--text-dark); }

    .container {
      width: 95%; max-width: 750px; padding: 35px;
      background: var(--card-light); border-radius: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
      position: relative; transition: all 0.4s ease;
    }
    body.dark .container { background: var(--card-dark); box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4); }

    /* Header Controls */
    .header-controls {
      display: flex; justify-content: flex-end; align-items: center;
      gap: 12px; margin-bottom: 25px;
    }

    .control-item {
      background: rgba(0,0,0,0.04); padding: 8px 15px; border-radius: 14px;
      display: flex; align-items: center; gap: 8px; transition: 0.3s;
      border: 1px solid rgba(0,0,0,0.05);
    }
    body.dark .control-item { background: rgba(255,255,255,0.06); border-color: rgba(255,255,255,0.1); }

    select, .theme-label { background: transparent; border: none; font-size: 14px; font-weight: 600; cursor: pointer; color: inherit; outline: none; }

    /* Modern Bold Arrows (Fixed from IMG_5171) */
    details { margin-bottom: 15px; border-radius: 20px; border: 1px solid rgba(0,0,0,0.03); background: rgba(0,0,0,0.01); transition: 0.3s; }
    body.dark details { border-color: rgba(255,255,255,0.05); }

    summary {
      padding: 20px; list-style: none; cursor: pointer; display: flex; align-items: center;
      font-weight: 700; font-size: 1.2rem;
    }
    summary::-webkit-details-marker { display: none; }

    .arrow-icon {
      width: 24px; height: 24px; margin-right: 15px; fill: var(--primary);
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    details[open] .arrow-icon { transform: rotate(180deg); }

    /* Inputs (Fixed Sync Problem from IMG_5173) */
    .input-row { display: flex; flex-wrap: wrap; gap: 15px; padding: 0 20px 20px; }
    input {
      flex: 1; min-width: 140px; padding: 15px; border: 2px solid transparent; border-radius: 16px;
      background: rgba(0,0,0,0.03); font-size: 15px; outline: none; transition: 0.3s; color: inherit;
    }
    body.dark input { background: rgba(255,255,255,0.05); }
    input:focus { border-color: var(--primary); background: transparent; }

    /* Buttons */
    button { padding: 14px 28px; border: none; border-radius: 18px; font-weight: 700; cursor: pointer; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    button.primary { background: var(--primary); color: white; }
    button.primary:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3); }
    button.secondary { background: #546e7a; color: white; }
    button.delete { background: #ff5252; color: white; padding: 10px; min-width: 45px; }

    /* Result Area */
    #result { margin-top: 25px; padding: 25px; border-radius: 22px; background: rgba(76, 175, 80, 0.08); transition: 0.5s; }
    body.dark #result { background: rgba(76, 175, 80, 0.15); }

    /* Tutorial Button (Fixed Shadow from IMG_5174) */
    .tutorial-btn {
      position: absolute; top: 25px; left: 25px; width: 45px; height: 45px;
      border-radius: 50%; background: var(--primary); color: white; border: none;
      font-size: 20px; font-weight: bold; cursor: pointer;
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2); transition: 0.3s;
    }
    .tutorial-btn:hover { transform: scale(1.1); box-shadow: 0 6px 15px rgba(76, 175, 80, 0.3); }

    /* Video Modal */
    #tutorialModal {
      display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.75);
      backdrop-filter: blur(10px); z-index: 2000; align-items: center; justify-content: center;
    }
    .modal-content {
      background: var(--card-light); padding: 25px; border-radius: 30px; width: 90%; max-width: 650px;
      position: relative; transform: scale(0.9); transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    body.dark .modal-content { background: var(--card-dark); }
    #tutorialModal.active { display: flex; }
    #tutorialModal.active .modal-content { transform: scale(1); }
    .close-modal { position: absolute; top: 15px; right: 15px; width: 35px; height: 35px; border-radius: 50%; background: #ff5252; color: white; border: none; cursor: pointer; }

    /* Donate Button */
    .donate-btn {
      position: fixed; bottom: 30px; right: 30px; padding: 15px 25px;
      background: #FFD700; color: #000; font-weight: 800; border-radius: 50px;
      text-decoration: none; box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
      display: flex; align-items: center; gap: 10px; transition: 0.3s; z-index: 1000;
    }
    .donate-btn:hover { transform: translateY(-5px) scale(1.05); }

    #version { position: fixed; bottom: 15px; left: 20px; font-size: 11px; opacity: 0.4; font-weight: 600; }
  </style>
</head>
<body class="light">

  <div class="container">
    <button class="tutorial-btn" onclick="openTutorial()">?</button>
    
    <div class="header-controls">
      <div class="control-item">
        <span>üåê</span>
        <select id="langSelect" onchange="switchLang()">
          <option value="th">‡πÑ‡∏ó‡∏¢</option>
          <option value="en">English</option>
        </select>
      </div>
      <div class="control-item" onclick="toggleDarkMode()" style="cursor:pointer;">
        <span id="themeIcon">üåì</span>
        <span id="themeBtn" class="theme-label"></span>
      </div>
    </div>

    <h2 id="title" style="text-align:center; font-size: 2rem; margin-top: 0;"></h2>

    <details open>
      <summary>
        <svg class="arrow-icon" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"/></svg>
        <span id="labelMaterial"></span>
      </summary>
      <div id="materials"></div>
      <div style="padding: 0 20px 20px;">
        <button onclick="addMaterial()" class="primary" id="addBtn" style="font-size: 14px; padding: 10px 20px;"></button>
      </div>
    </details>

    <details>
      <summary>
        <svg class="arrow-icon" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"/></svg>
        <span id="labelLabor"></span>
      </summary>
      <div class="input-row">
        <input type="text" id="workers" oninput="calculate()">
        <input type="text" id="wage" oninput="calculate()">
      </div>
      <div class="input-row">
        <input type="text" id="water" oninput="calculate()">
        <input type="text" id="electricity" oninput="calculate()">
      </div>
    </details>

    <div style="display: flex; gap: 15px; margin-top: 25px;">
      <button onclick="calculate()" id="calcBtn" class="primary" style="flex: 2; font-size: 18px;"></button>
      <button onclick="resetAll()" id="resetBtn" class="secondary" style="flex: 1;"></button>
    </div>

    <div id="result"></div>
  </div>

  <div id="tutorialModal" onclick="closeTutorial()">
    <div class="modal-content" onclick="event.stopPropagation()">
      <button class="close-modal" onclick="closeTutorial()">‚úï</button>
      <h3 id="tutTitle" style="text-align:center; margin-bottom: 20px;"></h3>
      <video id="tutVideo" controls muted playsinline style="width:100%; border-radius:20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
        <source src="tutorial.mp4" type="video/mp4">
      </video>
    </div>
  </div>

  <a href="https://tmn.app.link/Y5OprkLlj0b" target="_blank" class="donate-btn">
    <span>üíé</span><span id="donateText"></span>
  </a>

  <div id="version">v2.2.5</div>

  <script>
    const texts = {
      th: {
        title: "Cost Calculator Pro", materials: "‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö", labor: "‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á & ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢",
        workers: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô", wage: "‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏ï‡πà‡∏≠‡∏Ñ‡∏ô", water: "‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥", electricity: "‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü",
        matName: "‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö", matQty: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô", matCost: "‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢", matProfit: "‡∏Å‡∏≥‡πÑ‡∏£/‡∏´‡∏ô‡πà‡∏ß‡∏¢",
        add: "+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö", calc: "‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ‚Üì", reset: "‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï", donate: "‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô",
        darkMode: "‡πÇ‡∏´‡∏°‡∏î‡∏°‡∏∑‡∏î", lightMode: "‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏ß‡πà‡∏≤‡∏á", autoMode: "‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏ö‡∏ö",
        sumLabor: "‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏£‡∏ß‡∏°", sumMat: "‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö", sumTotal: "‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥",
        sale: "‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥", empty: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì", tut: "‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô", symbol: "‡∏ø", symBefore: false
      },
      en: {
        title: "Cost Calculator Pro", materials: "Materials", labor: "Expenses",
        workers: "Workers", wage: "Wage/Person", water: "Water", electricity: "Electricity",
        matName: "Name", matQty: "Qty", matCost: "Cost/Unit", matProfit: "Profit/Unit",
        add: "+ Add Item", calc: "Calculate ‚Üì", reset: "Reset", donate: "Donate",
        darkMode: "Dark", lightMode: "Light", autoMode: "Auto",
        sumLabor: "Total Labor", sumMat: "Material Cost", sumTotal: "Net Cost",
        sale: "Recommended Price", empty: "Enter data to calculate", tut: "User Manual", symbol: "$", symBefore: true
      }
    };

    function toggleDarkMode() {
      const curr = localStorage.getItem("theme") || "auto";
      const next = curr === "auto" ? "dark" : (curr === "dark" ? "light" : "auto");
      localStorage.setItem("theme", next);
      applyTheme();
    }

    function applyTheme() {
      const mode = localStorage.getItem("theme") || "auto";
      const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const t = texts[document.getElementById("langSelect").value];
      const shouldDark = mode === "dark" || (mode === "auto" && isDark);
      
      document.body.className = shouldDark ? "dark" : "light";
      document.getElementById("themeBtn").textContent = mode === "dark" ? t.darkMode : (mode === "light" ? t.lightMode : t.autoMode);
      document.getElementById("themeIcon").textContent = shouldDark ? "üåô" : "‚òÄÔ∏è";
    }

    function switchLang() {
      const lang = document.getElementById("langSelect").value;
      const t = texts[lang];
      localStorage.setItem("lang", lang);

      // Main UI
      document.getElementById("title").textContent = t.title;
      document.getElementById("labelMaterial").textContent = t.materials;
      document.getElementById("labelLabor").textContent = t.labor;
      document.getElementById("addBtn").textContent = t.add;
      document.getElementById("calcBtn").textContent = t.calc;
      document.getElementById("resetBtn").textContent = t.reset;
      document.getElementById("donateText").textContent = t.donate;
      document.getElementById("tutTitle").textContent = t.tut;

      // Input Placeholders (Fixed Sync Problem)
      document.getElementById("workers").placeholder = t.workers;
      document.getElementById("wage").placeholder = t.wage;
      document.getElementById("water").placeholder = t.water;
      document.getElementById("electricity").placeholder = t.electricity;

      document.querySelectorAll("#materials .input-row").forEach(row => {
        row.children[0].placeholder = t.matName;
        row.children[1].placeholder = t.matQty;
        row.children[2].placeholder = t.matCost;
        row.children[3].placeholder = t.matProfit;
      });

      applyTheme();
      calculate();
    }

    function addMaterial(n="", q="", c="", p="") {
      const t = texts[document.getElementById("langSelect").value];
      const div = document.createElement("div");
      div.className = "input-row";
      div.innerHTML = `
        <input type="text" placeholder="${t.matName}" value="${n}" style="flex:2" oninput="saveData()">
        <input type="text" placeholder="${t.matQty}" value="${q}" oninput="calculate()">
        <input type="text" placeholder="${t.matCost}" value="${c}" oninput="calculate()">
        <input type="text" placeholder="${t.matProfit}" value="${p}" oninput="calculate()">
        <button class="delete" onclick="this.parentElement.remove(); saveData(); calculate();">‚úï</button>
      `;
      document.getElementById("materials").appendChild(div);
      saveData();
    }

    function calculate() {
      const t = texts[document.getElementById("langSelect").value];
      const getV = (id) => parseFloat(document.getElementById(id).value.replace(/[^0-9.]/g, '')) || 0;
      
      const wks = getV("workers"), wge = getV("wage"), wtr = getV("water"), elc = getV("electricity");
      let mTot = 0, pTot = 0, has = (wks > 0 || wtr > 0 || elc > 0);

      document.querySelectorAll("#materials .input-row").forEach(r => {
        const q = parseFloat(r.children[1].value) || (r.children[1].value ? 1 : 0);
        const c = parseFloat(r.children[2].value) || 0;
        const p = parseFloat(r.children[3].value) || 0;
        if (q > 0 || c > 0) has = true;
        mTot += q * c; pTot += q * p;
      });

      const res = document.getElementById("result");
      if (!has) { res.innerHTML = `<center style="opacity:0.5">${t.empty}</center>`; return; }

      const lab = wks * wge, net = lab + wtr + elc + mTot, sale = net + pTot;
      const f = (v) => t.symBefore ? t.symbol + v.toLocaleString() : v.toLocaleString() + " " + t.symbol;

      res.innerHTML = `
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
          <span>${t.sumLabor}:</span> <strong>${f(lab)}</strong>
          <span>${t.sumMat}:</span> <strong>${f(mTot)}</strong>
          <span style="border-top:1px solid rgba(0,0,0,0.1); padding-top:8px;">${t.sumTotal}:</span> 
          <strong style="border-top:1px solid rgba(0,0,0,0.1); padding-top:8px;">${f(net)}</strong>
        </div>
        <div style="text-align:center; margin-top:20px; border-top:2px dashed rgba(0,0,0,0.1); padding-top:15px;">
          <small>${t.sale}</small><br><strong style="font-size:2.2rem; color:var(--primary);">${f(sale)}</strong>
        </div>`;
      saveData();
    }

    function openTutorial() {
      const m = document.getElementById("tutorialModal");
      m.style.display = "flex";
      setTimeout(() => m.classList.add("active"), 10);
      document.getElementById("tutVideo").play();
    }

    function closeTutorial() {
      const m = document.getElementById("tutorialModal");
      m.classList.remove("active");
      document.getElementById("tutVideo").pause();
      setTimeout(() => m.style.display = "none", 400);
    }

    function saveData() {
      const data = {
        w: document.getElementById("workers").value, wg: document.getElementById("wage").value,
        wt: document.getElementById("water").value, el: document.getElementById("electricity").value,
        m: Array.from(document.querySelectorAll("#materials .input-row")).map(r => ({
          n: r.children[0].value, q: r.children[1].value, c: r.children[2].value, p: r.children[3].value
        }))
      };
      localStorage.setItem("calc_v244", JSON.stringify(data));
    }

    function loadData() {
      const s = JSON.parse(localStorage.getItem("calc_v244") || "{}");
      document.getElementById("langSelect").value = localStorage.getItem("lang") || "th";
      document.getElementById("workers").value = s.w || "";
      document.getElementById("wage").value = s.wg || "";
      document.getElementById("water").value = s.wt || "";
      document.getElementById("electricity").value = s.el || "";
      if (s.m && s.m.length > 0) s.m.forEach(i => addMaterial(i.n, i.q, i.c, i.p));
      else addMaterial();
      switchLang();
    }

    function resetAll() { if(confirm("Clear data?")) { localStorage.clear(); location.reload(); } }
    window.onload = loadData;
  </script>
</body>
</html>
